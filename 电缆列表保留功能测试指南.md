# 电缆列表保留功能测试指南

## 测试目标
验证在修改目标库位和提交失败时，已扫描的电缆列表能够正确保留。

## 测试环境
- 设备: CRUISE2 Android PDA
- 应用: 拣货验证应用 v1.0.0
- 测试日期: 2025-10-28

## 测试场景

### 场景 1: 修改目标库位时保留电缆列表

**测试步骤**:
1. 登录应用，进入工作台
2. 点击"电缆上架"功能
3. 扫描或输入目标库位代码（例如：L001）
4. 点击"确认库位"
5. 扫描添加多个电缆条码（建议至少 3 盘）
   - 示例条码: 1234567890123, 1234567890124, 1234567890125
6. 点击"修改"按钮（在目标库位旁边）
7. **验证点**: 观察电缆列表是否保留
8. 输入新的目标库位代码（例如：L002）
9. 点击"确认库位"
10. **验证点**: 确认之前扫描的电缆列表仍然存在

**预期结果**:
- ✅ 点击"修改"后，电缆列表应该保留（数量不变）
- ✅ 界面回到库位输入状态
- ✅ 设置新库位后，之前的电缆列表仍然显示
- ✅ 可以继续添加新的电缆到列表中
- ✅ 提交按钮显示正确的电缆数量

**失败标志**:
- ❌ 修改库位后电缆列表被清空
- ❌ 设置新库位后看不到之前的电缆
- ❌ 电缆数量显示为 0

---

### 场景 2: 提交失败时保留电缆列表

**测试步骤**:
1. 登录应用，进入"电缆上架"功能
2. 设置目标库位（例如：TEST01）
3. 添加多个电缆条码（建议至少 3 盘）
4. 点击"确认上架"按钮
5. 在确认对话框中点击"确认"
6. **模拟失败**: 如果提交失败（网络错误或服务器错误）
7. **验证点**: 观察错误提示后，电缆列表是否保留

**预期结果**:
- ✅ 提交失败后显示错误消息（SnackBar 或对话框）
- ✅ 错误消息显示后，电缆列表仍然完整
- ✅ 目标库位信息保持不变
- ✅ 可以重新尝试提交
- ✅ 可以继续添加或删除电缆

**失败标志**:
- ❌ 提交失败后电缆列表被清空
- ❌ 需要重新扫描所有电缆
- ❌ 界面回到初始状态

---

### 场景 3: 综合测试 - 多次修改和失败

**测试步骤**:
1. 设置初始库位: L001
2. 添加 3 盘电缆
3. 修改库位为: L002
4. **验证**: 3 盘电缆仍在列表中
5. 继续添加 2 盘电缆（总共 5 盘）
6. 修改库位为: L003
7. **验证**: 5 盘电缆仍在列表中
8. 尝试提交（如果失败）
9. **验证**: 失败后 5 盘电缆仍在列表中
10. 重新提交直到成功

**预期结果**:
- ✅ 每次修改库位后，所有电缆都保留
- ✅ 可以在不同库位之间多次切换
- ✅ 提交失败不会丢失数据
- ✅ 最终成功提交时，所有电缆都转移到最新的目标库位

---

## 测试要点

### 1. 数据持久性
- 修改库位时不丢失电缆列表
- 提交失败时不丢失电缆列表
- 电缆数量统计始终准确

### 2. 用户体验
- 修改库位操作流畅
- 错误提示清晰明确
- 无需重复扫描电缆
- 减少操作步骤和时间

### 3. 边界情况
- 空列表时修改库位（应该正常工作）
- 大量电缆时修改库位（例如 50 盘以上）
- 连续多次修改库位
- 网络不稳定时的行为

---

## 测试数据

### 建议使用的测试数据

**目标库位代码**:
- L001, L002, L003, L004
- ZONE-A-01, ZONE-B-02
- TEST01, TEST02

**电缆条码** (13位):
- 1234567890123
- 1234567890124
- 1234567890125
- 2345678901234
- 3456789012345

**注意**: 如果使用真实环境，请确保条码在系统中存在且不在目标库位。

---

## 问题记录

### 已修复的问题
1. ✅ 修改目标库位时电缆列表被清空
   - 原因: `ModifyTargetLocation` 事件处理直接 emit `LineStockInitial()`
   - 修复: 保留 `cableList`，只清除 `targetLocation`

2. ✅ 提交失败时电缆列表被清空
   - 状态: 此功能之前已正确实现
   - 机制: 通过 `previousState` 保存失败前的状态

### 待观察的行为
- [ ] 修改库位后的界面过渡是否流畅
- [ ] 电缆数量统计是否实时更新
- [ ] 错误提示是否清晰易懂
- [ ] 长列表滚动性能是否良好

---

## 测试结论

**测试人员**: _____________
**测试日期**: _____________
**测试结果**: ⬜ 通过  ⬜ 失败  ⬜ 部分通过

**详细说明**:
```
记录测试过程中发现的问题和建议
```

**签名**: _____________
