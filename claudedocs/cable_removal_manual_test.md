# 电缆下架功能 - 手工测试指南

## 测试准备

### 1. 启动应用
```bash
flutter run
```

### 2. 访问工作台
- 应用启动后,直接进入工作台主页面
- 顶部显示: "WMS工作台"
- 右上角显示: 操作员001

## 测试步骤

### 步骤1: 找到电缆下架入口

在工作台主页面:
1. 向下滚动查看功能组
2. 找到 **"断线线边管理"** 功能组(橙色图标)
3. 在第一行右侧找到 **"电缆下架"** 卡片
   - 图标: 下载图标 (download)
   - 标题: "电缆下架"
   - 副标题: "下架到线边库"
   - 颜色: 明亮橙色

### 步骤2: 进入电缆下架页面

1. 点击 **"电缆下架"** 卡片
2. 应该看到电缆下架页面,包含:
   - 顶部AppBar标题: "电缆下架"
   - 返回按钮和重置按钮
   - 固定目标库位显示区域

### 步骤3: 验证固定库位

在电缆下架页面顶部:
1. 应该看到一个蓝色框显示目标库位
2. 内容包括:
   - 仓库图标
   - 库位号: **2200-100**
   - 蓝色标签: "线边库"
   - 锁图标 (表示固定,不可修改)
   - 文字提示: "(固定)"

### 步骤4: 扫描电缆条码

1. 点击 **"扫描条码"** 按钮
2. 扫描器界面应该打开
3. 扫描一个有效的电缆条码(格式: CBLxxxxxx)
4. 扫描成功后:
   - 应该返回电缆下架页面
   - 电缆列表中显示刚扫描的电缆
   - 显示电缆编号、规格型号、长度等信息

### 步骤5: 添加多个电缆

重复步骤4,扫描多个不同的电缆条码:
1. 每次扫描后电缆列表应该增加
2. 页面底部应该显示电缆数量统计
3. "确认下架"按钮应该变为可用状态(蓝色)

### 步骤6: 删除电缆(可选)

如果需要移除某个电缆:
1. 在电缆列表中找到要删除的电缆
2. 点击该电缆卡片右侧的删除图标
3. 电缆应该从列表中移除
4. 电缆数量统计应该更新

### 步骤7: 确认下架

1. 点击底部的 **"确认下架"** 按钮
2. 应该弹出确认对话框,显示:
   - 标题: "确认下架"
   - 内容: "确定要将 X 盘电缆下架到线边库 (2200-100) 吗?"
   - 两个按钮: "取消" 和 "确认"
3. 点击 **"确认"** 按钮

### 步骤8: 验证结果

下架提交后:
1. 应该显示成功对话框
2. 对话框内容:
   - 成功图标(绿色勾)
   - 标题: "下架成功"
   - 提示: "电缆已成功下架到线边库 (2200-100)"
   - 两个按钮: "返回首页" 和 "继续下架"

### 步骤9: 继续操作

根据需要选择:
- **继续下架**: 点击"继续下架"按钮,返回空白的下架页面,可以继续扫描新的电缆
- **返回首页**: 点击"返回首页"按钮,返回工作台主页面

## 测试重置功能

在电缆下架页面:
1. 扫描一些电缆条码
2. 点击右上角的 **"重置"** 按钮
3. 应该弹出确认对话框
4. 点击"确定"
5. 验证:
   - 电缆列表被清空
   - 但目标库位仍然固定为 2200-100(不受重置影响)
   - 可以重新开始扫描电缆

## 预期行为对比

### 电缆上架 vs 电缆下架

| 功能 | 电缆上架 | 电缆下架 |
|------|---------|---------|
| 第一步 | 扫描目标库位(可变) | 自动设置为2200-100(固定) |
| 库位显示 | 可编辑的输入框 | 固定显示 + 锁图标 |
| 第二步 | 扫描电缆 | 扫描电缆(相同) |
| 按钮文字 | "确认上架" | "确认下架" |
| 成功提示 | "电缆已成功上架到..." | "电缆已成功下架到线边库..." |

## 常见问题排查

### 问题1: 点击卡片没有反应
- 检查路由配置是否正确
- 查看控制台是否有错误信息

### 问题2: 目标库位不是2200-100
- 检查 `LineStockConstants.lineStockLocation` 的值
- 确认 initState 中的自动设置逻辑执行成功

### 问题3: 扫描后电缆没有添加到列表
- 检查 BLoC 状态更新
- 查看控制台日志中的 print 输出

### 问题4: 确认下架按钮不可用
- 确认至少扫描了一个电缆
- 检查 `canSubmit` 状态是否为 true

## 测试检查清单

- [ ] 工作台显示"电缆下架"卡片
- [ ] 点击卡片能正常导航
- [ ] 页面标题显示"电缆下架"
- [ ] 目标库位自动设置为2200-100
- [ ] 目标库位显示锁图标和"(固定)"文字
- [ ] 扫描按钮正常工作
- [ ] 扫描电缆能添加到列表
- [ ] 电缆数量统计正确
- [ ] 删除电缆功能正常
- [ ] 重置功能清空列表但保持固定库位
- [ ] 确认下架对话框显示正确信息
- [ ] 下架成功后显示成功对话框
- [ ] "继续下架"返回空白页面
- [ ] "返回首页"正确导航回工作台

## 注意事项

1. **固定库位**: 电缆下架的目标库位始终固定为 2200-100,无法修改
2. **线边库标识**: 页面会显示蓝色的"线边库"标签,与普通上架区分
3. **重置行为**: 重置只清空电缆列表,不改变固定库位(2200-100)
4. **扫描验证**: 确保扫描的是有效的电缆条码(CBL开头)
