# 线边库存管理功能 - 需求规格说明

**文档版本**: 1.0
**创建日期**: 2025-10-27
**负责团队**: 移动端开发组
**目标平台**: Android 工业PDA

---

## 1. 功能概述

### 1.1 业务背景

在制造业生产流程中，断线电缆等物料需要在生产线边的库位之间进行转移和管理。本功能为仓库操作员提供移动端工具，通过扫描条码实现：
- 快速查询电缆物料的当前库存状态
- 将电缆物料从当前位置转移到目标库位（上架操作）

### 1.2 目标用户

- **主要用户**: 仓库操作员、物料管理员
- **使用场景**: 使用工业PDA设备，在仓库现场操作
- **操作频率**: 高频使用（每天数十到上百次操作）

### 1.3 核心价值

- ✅ 提高库存查询效率（无需回到电脑前查询）
- ✅ 减少上架操作错误（扫码验证，避免手工记录错误）
- ✅ 实时更新库存位置（与MES系统同步）
- ✅ 提升仓库管理数字化水平

---

## 2. 功能需求

### 2.1 功能1: 库存查询

#### 用户故事
```
作为 仓库操作员
我想要 通过扫描电缆条码快速查询库存信息
以便于 立即了解该电缆的物料信息、数量和当前存放位置
```

#### 功能描述

用户可以通过扫描单个电缆条码或手动输入条码，查询该电缆在线边库存中的详细信息。

#### 操作流程

```mermaid
graph TD
    A[打开库存查询页面] --> B[扫描电缆条码]
    B --> C{条码格式有效?}
    C -->|否| D[显示格式错误提示]
    C -->|是| E[调用查询API]
    E --> F{查询成功?}
    F -->|否| G[显示错误信息]
    F -->|是| H[显示库存详情]
    D --> B
    G --> B
    H --> I{需要上架?}
    I -->|是| J[跳转到上架页面]
    I -->|否| K[继续查询其他条码]
```

#### 输入要求

| 输入项 | 类型 | 必填 | 格式要求 | 说明 |
|-------|------|------|---------|------|
| 条码 | String | 是 | 长度 > 0 | 电缆唯一条码标识 |
| 工厂ID | Integer | 否 | - | 可选参数，默认当前工厂 |

#### 输出展示

查询成功后，显示以下信息：

| 字段 | 说明 | 示例 |
|-----|------|-----|
| 物料编码 | 物料系统编码 | C12345 |
| 物料描述 | 物料名称和规格 | 断线电缆 XX型 |
| 当前数量 | 库存数量 | 150 PCS |
| 批次号 | 生产批次 | BATCH-001 |
| 当前库位 | 存放位置编码 | A-01-02 |
| 条码 | 查询的条码 | BC123456789 |

#### 验收标准

- [x] 支持扫码头扫描输入（自动提交）
- [x] 支持手动键盘输入（回车提交）
- [x] 扫描后输入框自动清空
- [x] 查询结果在2秒内返回并显示
- [x] 条码不存在时显示明确错误提示
- [x] 网络异常时显示友好提示并允许重试
- [x] 查询成功后可快速跳转到上架功能

---

### 2.2 功能2: 电缆上架（库存转移）

#### 用户故事
```
作为 仓库操作员
我想要 灵活地扫描电缆条码和目标库位来完成上架操作
以便于 根据实际情况选择先扫描电缆或先设置库位
```

#### 功能描述

用户可以灵活选择操作顺序：先扫描目标库位再扫描电缆，或者先扫描电缆再设置目标库位。系统自动验证每个条码并显示物料信息，用户确认后提交转移请求。这种灵活的流程更符合实际操作场景。

#### 操作流程

```mermaid
graph TD
    A[打开电缆上架页面] --> B{用户选择}
    B -->|先设置库位| C[扫描/输入目标库位]
    B -->|先扫描电缆| D[扫描电缆条码]

    C --> E[库位已设定]
    E --> D

    D --> F{条码有效?}
    F -->|否| G[显示条码错误]
    F -->|是| H{条码已存在?}
    G --> D

    H -->|是| I[提示重复]
    H -->|否| J[查询条码信息]
    I --> D

    J --> K{查询成功?}
    K -->|否| L[显示查询失败]
    K -->|是| M[添加到列表]
    L --> D

    M --> N{继续操作?}
    N -->|扫描电缆| D
    N -->|设置/修改库位| C
    N -->|编辑列表| O[删除/清空条码]
    N -->|确认上架| P{库位和电缆都已设置?}
    O --> N

    P -->|否| Q[显示提示信息]
    P -->|是| R[提交转移API]
    Q --> N

    R --> S{转移成功?}
    S -->|是| T[显示成功消息]
    S -->|否| U[显示错误并允许重试]
    T --> V[清空列表回到初始]
    U --> R
```

#### 灵活操作说明

**操作方式A: 先设置库位，后扫描电缆**
1. 打开页面后，先扫描或输入目标库位编码
2. 系统显示"已设定库位: XXX"
3. 然后连续扫描需要上架的电缆条码
4. 系统验证每个条码并添加到列表
5. 确认无误后提交上架

**操作方式B: 先扫描电缆，后设置库位**
1. 打开页面后，直接开始扫描电缆条码
2. 系统验证每个条码并添加到列表
3. 扫描完所有电缆后，再设置目标库位
4. 确认无误后提交上架

**操作方式C: 交替操作**
1. 可以先扫描部分电缆
2. 然后设置目标库位
3. 再继续扫描其他电缆
4. 随时可以修改目标库位
5. 确认无误后提交上架

**通用功能**
- **库位设置**: 始终显示在页面顶部，可随时设置或修改
- **电缆列表**: 显示已添加的电缆，包括条码号、物料信息、当前库位
- **列表编辑**: 可以删除单个电缆或清空整个列表
- **提交验证**: 确认上架时系统检查库位和电缆是否都已设置
- **智能提示**: 根据当前状态显示相应的提示信息

#### 输入要求

| 输入项 | 类型 | 必填 | 格式要求 | 说明 |
|-------|------|------|---------|------|
| 目标库位 | String | 是 | 库位编码格式 | 转移的目标位置 |
| 电缆条码列表 | Array<String> | 是 | 至少1个 | 需要转移的电缆条码 |

#### 约束条件

- ⚠️ 每次转移只能有一个目标库位
- ⚠️ 可以同时转移多个电缆到同一库位
- ⚠️ 条码不能重复（列表中唯一性）
- ⚠️ 每个条码必须通过查询验证后才能添加
- ✅ 目标库位和电缆列表的设置顺序灵活，可以任意调整
- ✅ 可以在任何时候修改目标库位，不会影响已添加的电缆列表

#### 输出展示

**已扫描列表项显示**:
```
┌────────────────────────────┐
│ 1. BC123456789              │
│    C12345 - 断线电缆         │
│    当前位置: A-01-02   [删除]│
└────────────────────────────┘
```

**转移信息摘要**:
- 目标库位: B-02-05
- 转移数量: 3 个电缆

#### 验收标准

- [x] 支持灵活的操作顺序：可以先设置库位或先扫描电缆
- [x] 库位输入框和电缆扫描区域始终可见
- [x] 可以随时修改已设定的目标库位
- [x] 可以在未设置库位时添加电缆
- [x] 可以连续扫描多个电缆条码
- [x] 扫描时自动查询并验证条码
- [x] 重复条码时提示并不添加
- [x] 无效条码时提示但保持当前列表
- [x] 可以删除单个条码
- [x] 可以清空整个列表
- [x] 提交时验证库位和电缆都已设置
- [x] 根据状态显示相应的提示信息（缺少库位/电缆/两者都缺）
- [x] 转移成功后显示成功消息
- [x] 转移成功后自动清空所有数据
- [x] 转移失败时允许重试
- [x] 所有操作响应时间 < 3秒

---

### 2.3 功能3: 电缆下架(转移到线边库)

#### 用户故事
```
作为 仓库操作员
我想要 通过扫描电缆条码批量完成下架到线边库操作
以便于 快速准确地将多个电缆转移到固定的线边库库位
```

#### 功能描述

电缆下架功能与电缆上架类似,但目标库位固定为线边库库位 `2200-100`,因此自动跳过设置库位步骤。用户只需连续扫描需要下架的电缆条码,系统自动验证并显示物料信息,用户确认后提交转移到线边库。

#### 操作流程

```mermaid
graph TD
    A[打开电缆下架页面] --> B[自动设置目标库位: 2200-100]
    B --> C[扫描电缆条码]
    C --> D{条码有效?}
    D -->|否| E[显示条码错误]
    D -->|是| F{条码已存在列表?}
    E --> C
    F -->|是| G[提示重复]
    F -->|否| H[查询条码信息]
    G --> C
    H --> I{查询成功?}
    I -->|否| J[显示查询失败]
    I -->|是| K[添加到列表]
    J --> C
    K --> L{继续扫描?}
    L -->|是| C
    L -->|否| M{需要编辑?}
    M -->|是| N[删除/清空条码]
    M -->|否| O[点击确认下架]
    N --> M
    O --> P[提交转移API]
    P --> Q{转移成功?}
    Q -->|是| R[显示成功消息]
    Q -->|否| S[显示错误并允许重试]
    R --> T[清空列表回到初始]
    S --> O
```

#### 分步操作说明

**步骤1: 自动设置目标库位**
- 系统自动设置目标库位为 `2200-100`(线边库)
- 页面顶部显示"目标库位: 2200-100 (线边库)"
- 用户无需手动输入或扫描库位

**步骤2: 扫描电缆条码(可多个)**
- 用户连续扫描电缆条码
- 每扫描一个条码,系统:
  1. 检查是否重复
  2. 调用查询API验证条码
  3. 获取物料信息
  4. 添加到列表并显示

**步骤3: 编辑列表(可选)**
- 每个条码项显示:
  - 条码号
  - 物料编码和描述
  - 当前库位
  - [删除] 按钮
- 顶部提供 [清空列表] 按钮

**步骤4: 确认下架**
- 检查:至少有一个电缆 ✓
- 点击 [确认下架] 提交
- 等待API响应
- 成功后清空所有数据

#### 输入要求

| 输入项 | 类型 | 必填 | 格式要求 | 说明 |
|-------|------|------|---------|---------|
| 目标库位 | String | 是 | 固定值: 2200-100 | 线边库固定位置(自动设置) |
| 电缆条码列表 | Array<String> | 是 | 至少1个 | 需要下架的电缆条码 |

#### 约束条件

- ⚠️ 目标库位固定为 `2200-100`,不可修改
- ⚠️ 可以同时下架多个电缆
- ⚠️ 条码不能重复(列表中唯一性)
- ⚠️ 每个条码必须通过查询验证后才能添加

#### 输出展示

**已扫描列表项显示**:
```
┌────────────────────────────┐
│ 1. BC123456789              │
│    C12345 - 断线电缆         │
│    当前位置: A-01-02   [删除]│
└────────────────────────────┘
```

**下架信息摘要**:
- 目标库位: 2200-100 (线边库)
- 下架数量: 3 个电缆

#### 验收标准

- [x] 自动设置目标库位为 2200-100
- [x] 目标库位不可修改
- [x] 可以连续扫描多个电缆条码
- [x] 扫描时自动查询并验证条码
- [x] 重复条码时提示并不添加
- [x] 无效条码时提示但保持当前列表
- [x] 可以删除单个条码
- [x] 可以清空整个列表
- [x] 列表为空时不能提交
- [x] 下架成功后显示成功消息
- [x] 下架成功后自动清空所有数据
- [x] 下架失败时允许重试
- [x] 所有操作响应时间 < 3秒

#### 与电缆上架的区别

| 特性 | 电缆上架 | 电缆下架 |
|-----|---------|---------|
| 详细描述 | 电缆上架或库位转移 | 下架到线边库 |
| 目标库位 | 用户扫描/输入 | 固定为 2200-100 |
| 操作步骤 | 两步(设置库位 → 扫描电缆) | 一步(扫描电缆) |
| 可修改库位 | 是 | 否(固定) |
| 使用场景 | 任意库位转移 | 固定转移到线边库 |

---

## 3. UI/UX 设计规范

### 3.1 设备适配

**目标设备**: Android 工业PDA
- 屏幕尺寸: 5-6 英寸
- 分辨率: 1280x720 或更高
- 方向: 竖屏（Portrait）
- 输入方式: 扫码头（主要）+ 触摸屏

### 3.2 设计原则

1. **大字体**: 最小字体 14sp，主要信息 16-20sp，标题 22-28sp
2. **高对比度**: 使用深色文字 + 白色背景，重要信息使用强调色
3. **大触摸区域**: 按钮最小 48dp x 48dp，行高最小 56dp
4. **简化操作**: 优先扫码输入，减少手动输入
5. **即时反馈**: 扫码后立即视觉/触觉反馈

### 3.3 颜色规范

| 用途 | 颜色 | 使用场景 |
|-----|------|---------|
| 主色调 | Blue #2196F3 | 按钮、标题栏 |
| 成功 | Green #4CAF50 | 成功提示、已完成状态 |
| 警告 | Orange #FF9800 | 警告信息 |
| 错误 | Red #F44336 | 错误提示、失败状态 |
| 中性 | Grey #757575 | 辅助文字、禁用状态 |
| 背景 | White #FFFFFF | 主背景 |
| 卡片背景 | Light Grey #F5F5F5 | 信息卡片背景 |

### 3.4 页面布局

#### 库存查询页面

```
┌─────────────────��───────────────────┐
│  📦 库存查询            [返回]       │  ← 标题栏 (56dp)
├─────────────────────────────────────┤
│                                     │
│  扫描电缆条码查询库存                │  ← 说明文字 (16sp)
│                                     │
│  ┌────────────────────────────┐    │
│  │  条码: [____________] 📷   │    │  ← 输入区域 (56dp)
│  └────────────────────────────┘    │
│                                     │
│  [查询库存] [清空]                   │  ← 操作按钮 (48dp)
│                                     │
│  ──────────────────────────────    │  ← 分隔线
│                                     │
│  库存信息                            │  ← 结果标题 (18sp)
│  ┌────────────────────────────┐    │
│  │ 📋 物料信息                 │    │
│  │ • 物料编码: C12345          │    │  ← 信息卡片
│  │ • 物料描述: 断线电缆 XX型    │    │     (行高 40dp)
│  │                            │    │
│  │ 📊 库存状态                 │    │
│  │ • 当前数量: 150 PCS        │    │
│  │ • 批次号: BATCH-001        │    │
│  │ • 当前库位: A-01-02        │    │
│  └────────────────────────────┘    │
│                                     │
│  [ 转到上架页面 ]                    │  ← 操作按钮 (56dp)
│                                     │
└─────────────────────────────────────┘
```

#### 电缆上架页面（灵活布局）

```
┌─────────────────────────────────────┐
│  📤 电缆上架            [返回][重置] │
├─────────────────────────────────────┤
│  📍 目标库位        [可选-可随时设置]│  ← 库位区域（紧凑）
│  ┌──────────────────┐  [确认]      │
│  │ B-02-05    📷    │              │  ← 库位输入（48dp）
│  └──────────────────┘              │
│  或                                 │
│  ┌──────────────────────────┐      │  ← 已设定状态
│  │ 📍 目标库位: B-02-05  [修改]│      │
│  └──────────────────────────┘      │
├─────────────────────────────────────┤
│  📦 扫描电缆条码                     │  ← 电缆区域（始终可见）
│  ┌────────────────────────────┐    │
│  │  条码: [____________] 📷   │    │  ← 条码输入 (48dp)
│  └────────────────────────────┘    │
│                                     │
│  已添加电缆 (3)          [清空列表]  │
│  ┌────────────────────────────┐    │
│  │ 1. BC123456789              │    │
│  │    C12345 - 断线电缆         │    │
│  │    当前位置: A-01-02   [删除]│    │
│  ├────────────────────────────┤    │
│  │ 2. BC123456790              │    │
│  │    C12346 - 断线电缆         │    │
│  │    当前位置: A-01-03   [删除]│    │
│  ├────────────────────────────┤    │
│  │ 3. BC123456791              │    │
│  │    C12347 - 断线电缆         │    │
│  │    当前位置: A-01-05   [删除]│    │
│  └────────────────────────────┘    │
├─────────────────────────────────────┤
│  ⚠️ 提示: 请设置目标库位            │  ← 智能提示
│  或                                 │
│  ⚠️ 提示: 请添加至少一盘电缆        │
│  或                                 │
│  ⚠️ 提示: 请设置目标库位并添加电缆  │
│                                     │
│  [确认上架 (3 盘)]                   │  ← 操作按钮 (56dp)
└─────────────────────────────────────┘

说明：
- 库位区域和电缆区域始终可见
- 用户可以按任意顺序操作
- 底部智能提示根据当前状态动态显示
- 确认按钮只有在库位和电缆都设置后才能点击
```

### 3.5 交互设计

#### 扫码体验优化

1. **自动聚焦**: 页面加载后输入框自动聚焦
2. **扫码提交**: 扫码头扫描后自动提交（延迟100ms防抖）
3. **自动清空**: 提交后自动清空输入框
4. **震动反馈**: 扫码成功后设备震动50ms
5. **声音反馈**: 可选的提示音（设置中开关）

#### 错误处理

| 错误类型 | 提示方式 | 提示内容 | 操作 |
|---------|---------|---------|------|
| 条码格式错误 | Toast + 震动 | "条码格式不正确" | 保持页面状态 |
| 条码不存在 | SnackBar | "未找到该条码的库存信息" | 允许重试 |
| 条码重复 | SnackBar | "条码已存在：BC123456789" | 不添加到列表 |
| 网络异常 | Dialog | "网络连接失败，请检查网络" | 提供重试按钮 |
| 转移失败 | Dialog | "上架失败：[具体原因]" | 提供重试按钮 |

#### 成功反馈

| 操作 | 反馈方式 | 提示内容 |
|-----|---------|---------|
| 查询成功 | 卡片展开动画 | 显示库存信息 |
| 添加成功 | 列表项滑入 + 震动 | 列表增加一项 |
| 转移成功 | Dialog + 震动 | "成功上架 3 个电缆到 B-02-05" |

---

## 4. 非功能性需求

### 4.1 性能要求

| 指标 | 要求 | 说明 |
|-----|------|------|
| API响应时间 | < 2秒 | 查询和转移接口 |
| 页面加载时间 | < 1秒 | 页面初始化 |
| 扫码响应时间 | < 500ms | 扫码到显示反馈 |
| 列表渲染 | 60fps | 流畅滚动 |
| 内存占用 | < 200MB | 应用运行时 |

### 4.2 可用性要求

- **网络容错**: 网络异常时不崩溃，显示友好提示
- **离线支持**: 暂不需要（V2考虑）
- **多语言**: 暂仅支持简体中文
- **易用性**: 新用户5分钟内学会使用

### 4.3 安全性要求

- ✅ API调用需要认证token
- ✅ 敏感信息不在日志中输出
- ✅ 网络传输使用HTTPS（生产环境）
- ✅ 用户操作记录审计日志

### 4.4 兼容性要求

- **Android版本**: Android 10 (API 29) 及以上
- **设备品牌**: 支持主流工业PDA（Honeywell, Zebra, Chainway等）
- **扫码头**: 支持标准HID键盘模式的扫码头

---

## 5. 约束条件与假设

### 5.1 技术约束

- ✓ 使用Flutter框架开发
- ✓ 遵循Clean Architecture架构
- ✓ 使用BLoC模式进行状态管理
- ✓ 使用Dio进行网络请求
- ✓ 使用mobile_scanner包支持相机扫码

### 5.2 业务约束

- ✓ 每次转移只能有一个目标库位
- ✓ 条码必须在系统中存在且有效
- ✓ 转移操作需要实时同步到MES系统
- ✓ 用户必须登录后才能使用此功能

### 5.3 假设

- ✓ 后端API已实现并可用
- ✓ 条码格式统一且唯一
- ✓ 库位编码格式统一
- ✓ 网络环境稳定（仓库内WiFi覆盖）
- ✓ 扫码头工作正常

---

## 6. 验收测试用例

### 6.1 库存查询功能

| 用例ID | 用例名称 | 前置条件 | 操作步骤 | 预期结果 |
|--------|---------|---------|---------|---------|
| TC-Q01 | 扫码查询成功 | 条码BC001在系统中存在 | 1. 打开查询页面<br>2. 扫描BC001 | 显示完整库存信息 |
| TC-Q02 | 手动输入查询 | - | 1. 手动输入BC002<br>2. 点击查询 | 显示库存信息 |
| TC-Q03 | 条码不存在 | 条码BC999不存在 | 1. 扫描BC999 | 显示"未找到库存信息" |
| TC-Q04 | 网络异常 | 断开网络 | 1. 扫描任意条码 | 显示网络错误提示 |
| TC-Q05 | 跳转上架 | 查询成功 | 1. 点击"转到上架页面" | 跳转到上架页面 |

### 6.2 电缆上架功能

| 用例ID | 用例名称 | 前置条件 | 操作步骤 | 预期结果 |
|--------|---------|---------|---------|---------|
| TC-S01 | 正常上架流程 | 库位B-01存在，条码BC001/BC002存在 | 1. 扫描库位B-01<br>2. 扫描BC001<br>3. 扫描BC002<br>4. 点击确认上架 | 转移成功，显示成功消息 |
| TC-S02 | 库位无效 | 库位XXX不存在 | 1. 扫描库位XXX | 显示库位错误提示 |
| TC-S03 | 条码重复 | - | 1. 设置库位<br>2. 扫描BC001<br>3. 再次扫描BC001 | 提示条码重复，不添加 |
| TC-S04 | 删除单个条码 | 列表中有3个条码 | 1. 点击第2个条码的删除按钮 | 该条码从列表移除 |
| TC-S05 | 清空列表 | 列表中有5个条码 | 1. 点击"清空列表" | 所有条码清空 |
| TC-S06 | 空列表提交 | 列表为空 | 1. 点击"确认上架" | 按钮禁用，无法提交 |
| TC-S07 | 修改库位 | 已设置库位A-01 | 1. 点击"修改库位"<br>2. 扫描新库位B-02 | 库位更新为B-02 |
| TC-S08 | 转移失败重试 | 转移API返回失败 | 1. 正常流程提交<br>2. API失败 | 显示错误信息和重试按钮 |

---

## 7. 术语表

| 术语 | 说明 |
|-----|------|
| PDA | Personal Digital Assistant，工业手持终端设备 |
| 条码 | 物料的唯一标识，可通过扫码头读取 |
| 库位 | 仓库中物料存放的具体位置编码 |
| 线边库存 | 生产线附近临时存放的库存 |
| 上架 | 将物料放置到指定库位的操作 |
| 扫码头 | 用于读取条码的扫描枪设备 |
| MES | Manufacturing Execution System，制造执行系统 |
| BLoC | Business Logic Component，状态管理模式 |

---

## 8. 附录

### 8.1 相关文档

- [API开发文档](../../API/API开发文档.md)
- [数据模型设计](./line-stock-data-model.md)
- [任务分解计划](./line-stock-tasks.md)

### 8.2 修订历史

| 版本 | 日期 | 修订内容 | 修订人 |
|-----|------|---------|--------|
| 1.0 | 2025-10-27 | 初始版本 | Claude Code |

---

**文档结束**
